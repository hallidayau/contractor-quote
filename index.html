<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Professional Scope Pack</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
    --primary:#1e3a8a;
    --bg:#eef2ff;
    --section:#ffffff;
    --border:#cbd5e1;
}
body{
    font-family: Arial, sans-serif;
    background:var(--bg);
    padding:15px;
}
h2{ color:var(--primary); }
h3{
    color:var(--primary);
    border-bottom:2px solid var(--primary);
    padding-bottom:5px;
}
input, textarea{
    width:100%;
    padding:10px;
    margin:6px 0;
    border:1px solid var(--border);
    border-radius:6px;
}
button{
    width:100%;
    padding:12px;
    margin-top:8px;
    background:var(--primary);
    color:white;
    border:none;
    border-radius:6px;
}
.section{
    background:var(--section);
    padding:18px;
    margin-top:18px;
    border-radius:10px;
}
.area{
    border-left:5px solid var(--primary);
    background:#f8fafc;
    padding:12px;
    margin-top:12px;
    border-radius:6px;
}
.dim-grid{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:8px;
}
.calc-box{
    background:#e0e7ff;
    padding:8px;
    border-radius:6px;
    font-size:14px;
}
.photo-buttons{
    display:flex;
    justify-content:space-between;
}
.photo-buttons button{
    width:48%;
}
.hidden{ display:none; }
</style>
</head>

<body>

<h2>Professional Scope Pack Generator</h2>

<div class="section">
<h3>Customer Details</h3>
<input id="customerName" placeholder="Customer Name">
<input id="customerPhone" placeholder="Customer Phone">
<input id="customerEmail" placeholder="Customer Email">
<input id="siteAddress" placeholder="Site Address">
</div>

<div class="section">
<h3>Front of Property (Required)</h3>
<div class="photo-buttons">
<button onclick="trigger('frontCamera')">ðŸ“· Take</button>
<button onclick="trigger('frontUpload')">ðŸ–¼ Upload</button>
</div>
<input type="file" id="frontCamera" accept="image/*" capture="environment" class="hidden">
<input type="file" id="frontUpload" accept="image/*" class="hidden">
</div>

<div class="section">
<h3>Areas</h3>
<div id="areas"></div>
<button onclick="addArea()">+ Add Area</button>
</div>

<button onclick="generatePDF()">Generate Professional PDF</button>

<script>

let areaCount = 0;

function trigger(id){
    document.getElementById(id).click();
}

function calculate(id){
    const w=parseFloat(document.getElementById("w"+id).value)||0;
    const l=parseFloat(document.getElementById("l"+id).value)||0;
    const h=parseFloat(document.getElementById("h"+id).value)||0;

    document.getElementById("floor"+id).innerText=(w*l).toFixed(2)+" mÂ²";
    document.getElementById("walls"+id).innerText=(2*h*(w+l)).toFixed(2)+" mÂ²";
    document.getElementById("volume"+id).innerText=(w*l*h).toFixed(2)+" mÂ³";
}

function addArea(){
    areaCount++;
    const div=document.createElement("div");
    div.className="area";
    div.innerHTML=`
        <h4>Area ${areaCount}</h4>
        <input id="areaName${areaCount}" placeholder="Area Name">
        <textarea id="desc${areaCount}" placeholder="Scope Description"></textarea>

        <div class="dim-grid">
            <input id="w${areaCount}" type="number" placeholder="Width (m)" oninput="calculate(${areaCount})">
            <input id="l${areaCount}" type="number" placeholder="Length (m)" oninput="calculate(${areaCount})">
            <input id="h${areaCount}" type="number" placeholder="Height (m)" oninput="calculate(${areaCount})">
        </div>

        <div class="calc-box">
            Floor: <span id="floor${areaCount}">0 mÂ²</span><br>
            Walls: <span id="walls${areaCount}">0 mÂ²</span><br>
            Volume: <span id="volume${areaCount}">0 mÂ³</span>
        </div>

        <div class="photo-buttons">
            <button onclick="trigger('areaCam${areaCount}')">ðŸ“· Take</button>
            <button onclick="trigger('areaUp${areaCount}')">ðŸ–¼ Upload</button>
        </div>
        <input type="file" id="areaCam${areaCount}" accept="image/*" capture="environment" multiple class="hidden">
        <input type="file" id="areaUp${areaCount}" accept="image/*" multiple class="hidden">
    `;
    document.getElementById("areas").appendChild(div);
}

async function generatePDF(){

    const frontFile =
        document.getElementById("frontCamera").files[0] ||
        document.getElementById("frontUpload").files[0];

    if(!frontFile){
        alert("Front property photo required.");
        return;
    }

    const { jsPDF } = window.jspdf;
    const doc=new jsPDF("p","mm","a4");

    const margin=20;
    const contentWidth=170;
    const leftColWidth=95;
    const rightColWidth=contentWidth-leftColWidth-10;

    let y=30;
    let pageNumber=1;

    function header(){
        doc.setFillColor(30,58,138);
        doc.rect(0,0,210,20,"F");
        doc.setTextColor(255,255,255);
        doc.setFontSize(14);
        doc.text("SCOPE OF WORKS",margin,13);
        doc.setTextColor(0,0,0);
        y=30;
    }

    function footer(){
        doc.setFontSize(8);
        doc.setTextColor(120);
        doc.text(
            "Generated "+new Date().toLocaleString()+" | Page "+pageNumber,
            margin,
            290
        );
        doc.setTextColor(0,0,0);
    }

    function check(space){
        if(y+space>270){
            footer();
            doc.addPage();
            pageNumber++;
            header();
        }
    }

    function readImage(file){
        return new Promise(resolve=>{
            const reader=new FileReader();
            reader.onload=e=>resolve(e.target.result);
            reader.readAsDataURL(file);
        });
    }

    header();

    function labelValue(label,value){
        doc.setFont(undefined,"bold");
        doc.text(label,margin,y);
        doc.setFont(undefined,"normal");
        y+=6;
        doc.text(value||"-",margin,y,{maxWidth:contentWidth});
        y+=10;
    }

    labelValue("Customer",customerName.value);
    labelValue("Phone",customerPhone.value);
    labelValue("Email",customerEmail.value);
    labelValue("Site Address",siteAddress.value);

    doc.setFont(undefined,"bold");
    doc.text("Property Identification",margin,y);
    doc.setFont(undefined,"normal");
    y+=8;

    const frontImg=await readImage(frontFile);
    const imgProps=doc.getImageProperties(frontImg);
    const imgHeight=(imgProps.height*contentWidth)/imgProps.width;

    check(imgHeight+10);
    doc.addImage(frontImg,"JPEG",margin,y,contentWidth,imgHeight);
    y+=imgHeight+15;

    for(let i=1;i<=areaCount;i++){

        check(60);

        doc.setFontSize(13);
        doc.setFont(undefined,"bold");
        doc.text("Area: "+(document.getElementById("areaName"+i).value||("Area "+i)),margin,y);
        doc.setFont(undefined,"normal");
        y+=10;

        let leftY=y;
        let rightY=y;

        function leftText(label,value){
            doc.setFont(undefined,"bold");
            doc.text(label,margin,leftY);
            doc.setFont(undefined,"normal");
            leftY+=6;
            doc.text(value||"-",margin,leftY,{maxWidth:leftColWidth});
            leftY+=8;
        }

        leftText("Description",document.getElementById("desc"+i).value);
        leftText("Width (m)",document.getElementById("w"+i).value);
        leftText("Length (m)",document.getElementById("l"+i).value);
        leftText("Height (m)",document.getElementById("h"+i).value);
        leftText("Floor Area",document.getElementById("floor"+i).innerText);
        leftText("Wall Area",document.getElementById("walls"+i).innerText);
        leftText("Volume",document.getElementById("volume"+i).innerText);

        const files=[
            ...document.getElementById("areaCam"+i).files,
            ...document.getElementById("areaUp"+i).files
        ];

        if(files.length){
            let photoX=margin+leftColWidth+10;
            const photoHeight=45;

            for(let file of files){
                const img=await readImage(file);
                check(photoHeight+10);
                doc.addImage(img,"JPEG",photoX,rightY,rightColWidth,photoHeight);
                rightY+=photoHeight+8;
            }
        }

        y=Math.max(leftY,rightY)+10;
    }

    footer();
    doc.save("Scope-Pack.pdf");
}

</script>
</body>
</html>
